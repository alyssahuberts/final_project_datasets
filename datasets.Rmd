---
title: "datasets"
author: "John Morse"
date: "2/25/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(janitor)
library(tidyverse)
library(gt)
library(rvest)
```


```{r}
webpage <- read_html("https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2426671/")
tbls <- html_nodes(webpage, "table")
head(tbls)

tbls_ls <- webpage %>%
        html_nodes("table") %>%
        .[[1]] %>%
        html_table(fill = TRUE)
tbls_ls
```
tbls_ls <- webpage %>%
        html_nodes("#Table1") %>%
        html_table(fill = TRUE)
```
tbls2_ls <- list()

tbls2_ls$Table1 <- webpage %>%
        html_nodes("#Table1") %>% 
        html_table(fill = TRUE) %>% 

head(tbls2_ls)


```

```{r}
# empty table where I will put the information
table_costs_ls <- list()

table_costs_ls$Table1 <- read_html("https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2426671/") %>% 
  html_nodes("table") %>% 
  html_table(fill =TRUE) %>% 
  .[[1]] 

table_costs_ls[[1]] <- table_costs_ls[[1]][-1,]

colnames(table_costs_ls[[1]] <- c("Parameter","Females", "Males", "Range_Applied"))

head(table_costs_ls[[1]], 5)

```
head(table_costs[[1]],)
table_costs[[1]] <-table_costs[[1]][-1]
colnames(table_costs[[1]] <- c("Parameter","Females", "Males", "Range_Applied"))

table_costs



```{r}
# This includes the direct medical costs associated with key STIs in the U.S.. I
# will be looking at the costs of HIV, chlamydia, gonorrhea, and I think
# syphilis as well. The prices listed are in 2006 USD, so I should create
# another column that calculates the 2019 USD cost for each infection.

table_costs <- list()

table_costs<- read_html("https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2426671/")%>% 
  html_node("table") %>% 
  html_table(header = TRUE) %>% 
  clean_names() %>% 
  slice(-1) %>% 
  slice(1:17)


table_costs[table_costs == "not applicable"] <-NA

colnames(table_costs)[2:3] <- c("xFemale", "xMale")

Long <- table_costs %>%
  pivot_longer(cols = starts_with("x"),
               names_to = "Sex",
               names_prefix = "x",
               values_to = "Cost",
               
               values_drop_na = FALSE
               )
Long
```
 
tidy_wb_data1 <- wb_data %>%
  pivot_longer(cols = starts_with("x"),
               names_to = "Year",
               names_prefix = "x",
               names_ptypes = list(Year = integer()),
               values_to = "CO2_emissions",
               values_drop_na = TRUE) %>% 
  select("country_name", "country_code", "Year", "CO2_emissions")
  
 
tidy_wb_data1


```{r}
prep_data_1 <- data.frame()
```

list.files("Data_Sets/PrEP_Data")
```{r}
# Function to read in all the files in my folder

list <- list.files("Data_Sets/PrEP_Data")

listxlsx <- dir(pattern = "*.xlsx")
for (i in 1:length(list)){
  print(list[i])
  temp_data <- read_xlsx(paste("Data_Sets/PrEP_Data/", list[i], sep = ""),
                         skip = 1) %>% 
    clean_names()
  prep_data_1 = rbind(prep_data_1, temp_data)
}

prep_data_1

```

```{r}
# Here I read in all the CDC data for Chlamydia and Gonorrhea rates from 2000 to 2017. I still should rename the columns so that it is clear which values are for which variable when I join the datasets. 
chlamydia_gonorrhea <-read_xlsx("Data_Sets/CDC_Data/ATLAS_CDC_Chlamydia&Gonorrhea.xlsx",
  skip = 5) %>% 
  clean_names()
chlamydia_gonorrhea[chlamydia_gonorrhea == "Data not available"] <-NA

chlamydia_gonorrhea

```

```{r}
# Here I read in all the CDC data for HIV/AIDS rates for females from 2008 to 2017. I have added an extra column to list what the sex is.

hiv_aids_f <- read_xlsx("Data_Sets/CDC_Data/Atlas_CDC_HIV:AIDS_Female.xlsx",
  skip = 8) %>% 
  clean_names() %>% 
  mutate(sex = "F")
hiv_aids_f[hiv_aids_f == "Data not available"] <-NA

hiv_aids_f
```

```{r}
# Here I read in all the CDC data for HIV/AIDS rates for males from 2008 to 2017. I have added an extra column to list what the sex is.
hiv_aids_m <- read_xlsx("Data_Sets/CDC_Data/AtlasPlus_CDC_Male_HIV:AIDS.xlsx",
  skip = 8) %>% 
  clean_names() %>% 
  mutate(sex = "M")
hiv_aids_m[hiv_aids_m == "Data not available"] <-NA

hiv_aids_m

```

```{r}
# Here I merged the two HIV/AIDS datasets as the variables were the same for each table.
hiv_aids_all <- rbind(hiv_aids_f, hiv_aids_m) %>% 
  arrange(desc(year))

hiv_aids_all
```


```{r}
# Here I read in all the CDC data for both early latent and congential syphilis rates from 2008 to 2017. I still should rename the columns so that it is clear which values are for which variable when I join the datasets. 
syphilis <- read_xlsx("Data_Sets/CDC_Data/Atlas_Congenital&EarlyLatentSyphilis.xlsx",
  skip = 7) %>% 
  clean_names()
syphilis[syphilis == "Data not available"] <-NA

syphilis

```



